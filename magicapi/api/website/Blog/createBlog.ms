{
  "properties" : { },
  "id" : "6e0e47e8cfb042b085a9fc0c62b4b57f",
  "script" : null,
  "groupId" : "96a0eee7dd8f4da2a65a69307c3ac4d9",
  "name" : "createBlog",
  "createTime" : null,
  "updateTime" : 1660899305452,
  "lock" : null,
  "createBy" : null,
  "updateBy" : "admin",
  "path" : "/createBlog",
  "method" : "POST",
  "parameters" : [ ],
  "options" : [ ],
  "requestBody" : "{\n  \"title\": \"D3.js åŠ›å¯¼å‘å›¾çš„æ˜¾ç¤ºä¼˜åŒ–\",\n  \"date\": \"2020-04-29 00:00:00\",\n  \"description\": \"æˆ‘ä»¬ç”¨ D3.js åŠ›å¯¼å‘å›¾å¯¹æ•°æ®å…³ç³»è¿›è¡Œåˆ†æï¼Œå…¶èŠ‚ç‚¹å’Œå…³ç³»çº¿ç›´è§‚åœ°ä½“ç°å›¾æ•°æ®åº“çš„æ•°æ®å…³ç³»ï¼Œè¿˜æ”¯æŒå…³è”ç›¸å¯¹åº”çš„å›¾æ•°æ®åº“è¯­å¥å®Œæˆæ‹“å±•æŸ¥è¯¢ã€‚æœ¬æ–‡ç€é‡è®²è§£å¦‚ä½•ä¼˜åŒ–æ–°å¢èŠ‚ç‚¹å’Œå¤šè¾¹å…³ç³»çš„æ˜¾ç¤º\",\n  \"tags\": [ \"å‘¨è¾¹å·¥å…·\", \"å¼€å‘æ—¥å¿—\" ],\n  \"author\": \"Nico\",\n  \"content\": \"\\n![d3](https://www-cdn.nebula-graph.com.cn/nebula-blog/d303.jpeg)\\n\\n## D3.js \\n\\nä½œä¸ºä¸€ä¸ªå‰ç«¯ï¼Œè¯´åˆ°å¯è§†åŒ–é™¤äº†å¬è¿‡ [D3.js](https://d3js.org/) çš„å¤§åï¼Œå¸¸è§çš„å¯è§†åŒ–åº“è¿˜æœ‰ [ECharts](https://echarts.apache.org/examples/zh/index.html)ã€[Chart.js](http://chartjs.cn/)ï¼Œè¿™ä¸¤ä¸ªåº“åŠŸèƒ½ä¹Ÿå¾ˆå¼ºå¤§ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå…±åŒç‰¹ç‚¹æ˜¯**å°è£…å±‚æ¬¡é«˜**ï¼Œç•™ç»™å¼€å‘è€…å¯è®¾è®¡å’Œæ§åˆ¶çš„éƒ¨åˆ†å¤ªå°‘ã€‚å’Œ EChartã€Chart.js ç­‰ç›¸æ¯”ï¼ŒD3.js **ç›¸å¯¹æ¥è¯´è‡ªç”±åº¦ä¼šé«˜å¾ˆå¤š**ï¼Œå¾—ç›Šäº D3.js ä¸­ **SVG ç”»å›¾å¯¹äº‹ä»¶å¤„ç†å™¨çš„æ”¯æŒ**ï¼ŒD3.js å¯å°†ä»»æ„æ•°æ®ç»‘å®šåˆ°æ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼ˆDOMï¼‰ä¸Šï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ“ä½œå¯¹è±¡æ¨¡å‹ï¼ˆDOMï¼‰å®Œæˆ [W3C DOM API](https://www.w3.org/DOM/DOMTR) ç›¸å…³æ“ä½œï¼Œå¯¹äºæƒ³è¦å±•ç¤ºè‡ªå·±è®¾è®¡å›¾å½¢çš„å¼€å‘è€…ï¼ŒD3.js ç»å¯¹æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚\\n\\n## d3-force åŠ›å¯¼å‘å›¾\\n\\næ‹¿å®ç°ä¸€ä¸ªå…³ç³»ç½‘ä¸ºä¾‹ï¼Œd3-force åŠ›å¯¼å‘å›¾æ˜¯ä¸äºŒçš„é€‰æ‹©ã€‚\\n\\n[d3-force](https://d3js.org.cn/document/d3-force/#installing) æ˜¯ D3.js å®ç°ä»¥æ¨¡æ‹Ÿç²’å­ç‰©ç†è¿åŠ¨çš„ [velocity Verlet](https://en.wikipedia.org/wiki/Verlet_integration) æ•°å€¼ç§¯åˆ†å™¨çš„æ¨¡å—ï¼Œå¯ç”¨æ¥æ§åˆ¶ç²’å­å’Œè¾¹ç§©åºã€‚åœ¨[åŠ›å¯¼å‘å›¾](https://d3js.org.cn/document/d3-force/#installing)ä¸­ï¼Œd3-force ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªæ”¾ç”µç²’å­ï¼Œç²’å­é—´å­˜åœ¨æŸç§æ–¥åŠ›ï¼ˆåº“ä»‘æ–¥åŠ›ï¼‰ã€‚åŒæ—¶ï¼Œè¿™äº›ç²’å­é—´è¢«å®ƒä»¬ä¹‹é—´çš„â€œè¾¹â€æ‰€ç‰µè¿ï¼Œä»è€Œäº§ç”Ÿç‰µå¼•åŠ›ã€‚\\n\\nåœ¨ d3-force ä¸­ï¼Œç²’å­åœ¨æ–¥åŠ›å’Œç‰µå¼•åŠ›çš„ä½œç”¨ä¸‹ï¼Œä»éšæœºæ— åºçš„åˆæ€ä¸æ–­å‘ç”Ÿä½ç§»ï¼Œé€æ¸è¶‹äºå¹³è¡¡æœ‰åºã€‚æ•´ä¸ªå›¾åªæœ‰ç‚¹ / è¾¹ï¼Œå›¾å½¢å®ç°[å®˜æ–¹æ ·ä¾‹](https://observablehq.com/collection/@d3/d3-force)è¾ƒå°‘ä¸”è‡ªå®šä¹‰æ ·å¼å±…å¤šã€‚\\n\\nä¸‹å›¾å°±æ˜¯æœ€ç®€å•çš„å…³ç³»ç½‘å›¾ï¼Œæƒ³è¦å®ç°è‡ªå·±æƒ³è¦çš„å…³ç³»ç½‘å›¾ï¼Œé‡‡ç”¨ D3.js æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚\\n\\n![d3-force](https://www-cdn.nebula-graph.com.cn/nebula-blog/d302.png)\\n\\n## æ„å»º D3.js åŠ›å¯¼å‘å›¾\\n\\nåœ¨è¿™é‡Œçš„å®è·µè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç”¨ D3.js åŠ›å¯¼å‘å›¾æ¥å¯¹å›¾æ•°æ®åº“çš„æ•°æ®å…³ç³»è¿›è¡Œåˆ†æï¼šå…¶èŠ‚ç‚¹å’Œå…³ç³»çº¿ç›´è§‚åœ°ä½“ç°å‡ºå›¾æ•°æ®åº“çš„æ•°æ®å…³ç³»ï¼Œä¸”æ”¯æŒå…³è”å¯¹åº”æŸ¥è¯¢è¯­å¥å®Œæˆæ‹“å±•æŸ¥è¯¢ã€‚è¿›é˜¶æ¥è¯´ï¼Œå¯é€šè¿‡å¯¹æ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼ˆDOMï¼‰çš„ç›´æ¥æ“ä½œåŒæ­¥æ•°æ®åº“è¿›è€Œæ›´æ–°æ•°æ®ï¼Œå½“ç„¶æ“ä½œè¿™ä¸ªæ¯”è¾ƒå¤æ‚ï¼ŒğŸ˜‚ ä¸åœ¨æœ¬æ–‡ä¸­è¯¦ç»†è®²è¿°ã€‚\\n\\nä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªç®€å•çš„åŠ›å¯¼å‘å›¾ï¼Œåˆçª¥ D3.js å¯¹æ•°æ®åˆ†æçš„ä½œç”¨å’Œæ˜¾ç¤ºä¼˜åŒ–çš„ä¸€äº›æ€è·¯ã€‚é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŠ›å¯¼å‘å›¾ï¼š\\n\\n```\\nthis.force = d3\\n        .forceSimulation()\\n        // ä¸ºèŠ‚ç‚¹åˆ†é…åæ ‡\\n        .nodes(data.vertexes)\\n        // è¿æ¥çº¿\\n        .force('link', linkForce)\\n        // æ•´ä¸ªå®ä¾‹ä¸­å¿ƒ\\n        .force('center', d3.forceCenter(width / 2, height / 2))\\n        // å¼•åŠ›\\n        .force('charge', d3.forceManyBody().strength(-20))\\n        // ç¢°æ’åŠ› é˜²æ­¢èŠ‚ç‚¹é‡å \\n        .force('collide',d3.forceCollide().radius(60).iterations(2));\\n```\\n\\né€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹é¢è¿™æ ·ä¸€ä¸ªå¯è§†åŒ–çš„èŠ‚ç‚¹å’Œå…³ç³»å›¾ã€‚\\n\\n![vertex-relation](https://www-cdn.nebula-graph.com.cn/nebula-blog/d303.png)\\n\\n### å®ç°æ‹“å±•æŸ¥è¯¢æ˜¾ç¤ºä¼˜åŒ–\\n\\nçœ‹åˆ°å…³ç³»å›¾ï¼ˆä¸Šå›¾ï¼‰ï¼Œæˆ‘ä»¬ä¼šå‘ç°æœ‰ä¸€ä¸ªæ–°éœ€æ±‚ï¼š**é€‰ä¸­èŠ‚ç‚¹ç»§ç»­å¾€ä¸‹æ‹“å±•æŸ¥è¯¢**ã€‚ä¸ºäº†å®ç°æ‹“å±•æŸ¥è¯¢ï¼Œåœ¨è¿™é‡Œç¬”è€…è¦ä»‹ç»ä¸‹ D3.js è‡ªå¸¦ APIã€‚\\n\\nD3.js çš„ [enter()](https://www.d3js.org.cn/#enter%E5%92%8Cexit%E6%93%8D%E4%BD%9C) API å¯å¯¹æ–°å¢çš„èŠ‚ç‚¹ä½œå•ç‹¬çš„é€»è¾‘å¤„ç†ï¼Œæ‰€ä»¥å½“æ‹“å±•æŸ¥è¯¢åˆ°æ–°çš„èŠ‚ç‚¹ push è¿›èŠ‚ç‚¹æ•°ç»„æ—¶ï¼Œä¸ä¼šå»æ”¹å˜ä¹‹å‰å­˜åœ¨çš„èŠ‚ç‚¹ä¿¡æ¯ï¼ˆåŒ…æ‹¬ xï¼Œy åæ ‡)ï¼Œè€Œæ˜¯æŒ‰ç…§ d3-force å®ä¾‹åˆ†é…çš„åæ ‡è¿›è¡Œæ¸²æŸ“ã€‚ä» API è§’åº¦æ¥ç†è§£ï¼Œè¿™æ ·å¤„ç†æ²¡é—®é¢˜ï¼Œä½†å¯¹ d3-force ä¸­å·²å­˜åœ¨çš„å®ä¾‹æ¥è¯´ï¼Œæ–°å¢çš„èŠ‚ç‚¹ä¸æ˜¯ä¸€ä¸ªç®€å•çš„ push å°±èƒ½å¤„ç†çš„ã€‚å› ä¸º [d3.forceSimulation()](https://github.com/d3/d3-force/blob/master/src/simulation.js)  è¿™ä¸ªæ¨¡å‹ç»™å½“å‰èŠ‚ç‚¹åˆ†é…çš„ä½ç½®åæ ‡ï¼ˆxï¼Œyï¼‰æ˜¯éšæœºï¼Œç›®å‰çœ‹æ¥è¿™æ ·æ“ä½œæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå¯¹ä¸å¯¹ï¼Ÿ\\n\\nä½†ç”±äº `d3.forceSimulation().node()` åæ ‡éšæœºåˆ†é…å¯¼è‡´äº†å›¾å½¢æ‹“å±•å‡ºæ¥ä½ç½®çš„éšæœºå‡ºç°ï¼Œåœ¨ä¹‹å‰ d3-force å®ä¾‹ä¸­æˆ‘ä»¬è®¾å®šå¥½çš„ collideï¼ˆç¢°æ’åŠ›ï¼‰å’Œ links ï¼ˆå¼•åŠ›ï¼‰å‚æ•°ä½œç”¨ä¸‹ï¼Œå’Œæ–°èŠ‚ç‚¹ç›¸å…³è”çš„èŠ‚ç‚¹å—åˆ°ç‰µå¼•åŠ›å½±å“äº’ç›¸é è¿‘ï¼Œåœ¨é è¿‘çš„è¿‡ç¨‹ä¸­åˆä¼šå’Œå…¶ä»–èŠ‚ç‚¹å‘ç”Ÿç¢°æ’ã€‚å½“åŠ›å¯¼å›¾å·²å­˜åœ¨èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œè¿™äº›æ–°å¢èŠ‚ç‚¹å‡ºç°æ—¶ä¼šè®©æ•´ä¸ªåŠ›å¯¼å‘å›¾åœ¨ collide å’Œ links çš„ä½œç”¨ä¸‹ä¸åœåœ°ç¢°æ’ï¼Œè¿›è¡Œç‰µå¼•ï¼Œç›´åˆ°æ¯ä¸ªèŠ‚ç‚¹éƒ½æ‰¾åˆ°è‡ªå·±åˆé€‚çš„ä½ç½®ï¼Œå³ç¢°æ’åŠ›å’Œç‰µå¼•åŠ›éƒ½æ»¡è¶³è¦æ±‚æ—¶æ‰åœæ­¢ç§»åŠ¨ï¼Œçœ‹çœ‹ä¸‹å›¾ï¼Œåƒä¸åƒå®‡å®™å¤§çˆ†ç‚¸ ğŸŒã€‚\\n\\n![d3](https://www-cdn.nebula-graph.com.cn/nebula-blog/d304.gif)\\n\\nä¸Šè¿°æ— åºåˆ°æœ‰åºç†µå‡çš„è¿‡ç¨‹ï¼Œç«™åœ¨ç”¨æˆ·è§’åº¦ï¼Œæ¯æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹å¯¼è‡´æ•´ä¸ªåŠ›å¯¼å›¾çš„è¿åŠ¨ï¼Œé™¤äº†æœ‰ä¸€ç§æŠ½ææ„Ÿï¼Œåœæ­¢å›¾å½¢å˜åŒ–åˆéœ€è¦é•¿æ—¶é—´çš„ç­‰å¾…ï¼Œè¿™æ˜¯ä¸èƒ½æ¥å—çš„ã€‚å¯ D3.js API [enter()](https://www.d3js.org.cn/#enter%E5%92%8Cexit%E6%93%8D%E4%BD%9C) åˆæ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œéš¾é“æ–°å¢çš„èŠ‚ç‚¹å’Œä¹‹å‰çš„èŠ‚ç‚¹çš„å‘ˆç°å¤„ç†éœ€è¦å¼€å‘è€…åˆ†å¼€å•ç‹¬å¤„ç†å—ï¼Ÿå¦‚æœæ˜¯åˆ†å¼€å•ç‹¬å¤„ç†ï¼Œæ¯æ¬¡èŠ‚ç‚¹æ¸²æŸ“éƒ½è¦éå†åˆ¤æ–­æ˜¯ä¸æ˜¯æ–°å¢ï¼Œåœ¨èŠ‚ç‚¹è¾ƒå¤šæ—¶åè€Œæ›´å½±å“æ€§èƒ½ï¼Ÿé‚£ä¹ˆå¦‚ä½•ä¼˜åŒ–è¿™ä¸ªæ–°å¢èŠ‚ç‚¹å‘ˆç°çš„é—®é¢˜å‘¢ï¼Ÿ\\n\\nç½‘ä¸Šè§£å†³æ–°å¢èŠ‚ç‚¹å‘ˆç°é—®é¢˜ï¼Œå¤§å¤šé‡‡ç”¨å‡å° d3-force å®ä¾‹ collideï¼Œå¢å¤§ links çš„ distance å‚æ•°å€¼ï¼Œè¿™æ ·ä¼šè®©èŠ‚ç‚¹å¾ˆå¿«åœ°æ‰¾åˆ°å¹³è¡¡ç‚¹ä»è€Œä½¿æ•´ä¸ªåŠ›å¯¼å›¾ç¨³å®šä¸‹æ¥ï¼Œè¿™ç¡®å®æ˜¯ä¸€ä¸ªå¥½åŠæ³•ã€‚ä½†æ˜¯è¿™æ ·èŠ‚ç‚¹ä¹‹é—´çš„è¿çº¿é•¿åº¦ç›¸å·®æ˜æ˜¾ï¼Œè€Œä¸”å›¾å½¢æ•´ä½“åå¤§ï¼Œå¯¹äºå¤§æ•°æ®é‡çš„ case æ¥è¯´ï¼Œè¿™ç§æ˜¾ç¤ºæ–¹å¼å¹¶ä¸å¤ªé€‚åˆã€‚\\n\\nåŸºäºä¸Šè¿°çš„æ–¹æ³•ï¼Œç¬”è€…æœ‰äº†å¦ä¸€ç§è§£å†³æ€è·¯â€”â€”**ä¿è¯æ–°å¢èŠ‚ç‚¹æ˜¯åœ¨è¯¥é€‰ä¸­æ‹“å±•çš„èŠ‚ç‚¹å‘¨å›´**ï¼Œä¹Ÿå°±æ˜¯è¯´ç›´æ¥æŠŠæ–°å¢èŠ‚ç‚¹çš„åæ ‡è®¾ç½®ä¸ºå¯¹åº”é€‰æ‹©æ‹“å±•èŠ‚ç‚¹ä¸€æ ·çš„ x,y åæ ‡è€Œä¸ç”¨ D3 .forceSimulation().node() åˆ†é…ï¼Œè¿™æ ·åˆ©ç”¨ d3-force è¿™ä¸ªå®ä¾‹çš„èŠ‚ç‚¹ç¢°æ’åŠ›ï¼Œä¿è¯æ–°å¢èŠ‚ç‚¹çš„å‡ºç°éƒ½ä¸ä¼šè¦†ç›–ï¼Œæœ€ç»ˆä¼šåœ¨é€‰ä¸­æ‹“å±•èŠ‚ç‚¹å‘¨å›´å‡ºç°ã€‚ è¿™æ ·å¤„ç†è™½ç„¶è¿˜æ˜¯å¯¹æ–°å¢èŠ‚ç‚¹å°çš„èŒƒå›´å†…çš„èŠ‚ç‚¹æœ‰å½±å“ï¼Œä½†ç›¸å¯¹æ¥è¯´ï¼Œä¸ä¼šå¤§å¹…åº¦åœ°å½±å“æ•´ä¸ªå…³ç³»å›¾å½¢èµ°åŠ¿ã€‚å…³é”®ä»£ç å¦‚ä¸‹ï¼š\\n\\n```\\n# ç»™æ–°å¢çš„åæ ‡è®¾ç½®ä¸ºæ‹“å±•èµ·ç‚¹ä¸­å¿ƒæˆ–æ•´ä¸ªå›¾ä¸­å¿ƒ\\naddVertexes.map(d => {\\n  d.x = _.meanBy(selectVertexes, 'x') || svg.style('width') / 2;\\n  d.y = _.meanBy(selectVertexes, 'y') || svg.style('heigth') / 2;\\n});\\n```\\n\\nå¦‚æœæ²¡æœ‰é€‰ä¸­èŠ‚ç‚¹ï¼ˆå³æ·»åŠ èµ·ç‚¹ï¼‰åˆ™è¯¥èµ·ç‚¹åæ ‡ä½ç½®å°±åœ¨å›¾ä¸­å¿ƒä½ç½®ï¼Œå¯¹å·²å­˜åœ¨çš„èŠ‚ç‚¹æ¥è¯´ï¼Œå½±å“ç¨‹åº¦ä¼šå°å¾ˆå¤šï¼Œè¿™è¿˜æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„æ€è·¯ï¼Œè¿™ä¸ªè§£å†³åŠæ³•å¯ä»¥æ¨èä¸€ä¸‹ã€‚\\n\\né™¤äº†æ–°å¢èŠ‚ç‚¹çš„å‘ˆç°é—®é¢˜ï¼Œæ•´ä¸ªå›¾å½¢çš„å‘ˆç°è¿˜æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼š**ä¸¤ç‚¹ä¹‹é—´å¤šè¾¹æ˜¾ç¤ºçš„ä¼˜åŒ–å¤„ç†**ã€‚\\n\\n### ä¸¤ç‚¹ä¹‹é—´å¤šè¾¹æ˜¾ç¤ºçš„ä¼˜åŒ–å¤„ç†\\n\\n> å½“ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´å­˜åœ¨å¤šæ¡è¾¹å…³ç³»æ—¶ï¼Œé»˜è®¤è¿æ¥çº¿æ˜¯ç›´çº¿çš„æƒ…å†µä¸‹è‚¯å®šä¼šå‡ºç°å¤šçº¿è¦†ç›–ã€‚å› æ­¤æ›²çº¿è¿æ¥ä¾¿æˆäº†æˆ‘ä»¬çš„å¦å¤–éœ€è¦è§£å†³çš„é—®é¢˜ã€‚\\n> æ›²çº¿å¦‚ä½•å®šä¹‰å¼¯æ›²åº¦ä¿è¯ä¸¤ç‚¹ä¹‹é—´çš„å¤šæ¡çº¿ä¸ä¼šäº¤äº’è¦†ç›–å‘¢ï¼Ÿåœ¨å¤šæ¡çº¿å¼¯æ›²ä¸‹ï¼Œå¦‚ä½•å¹³å‡åŠåœ†å¼§å¼¯æ›²é¿å…å…¨è·‘åˆ°æŸåŠåœ†å¼§ä¸Šï¼Ÿå®šä¹‰æ›²çº¿å¼§æ–¹å‘ï¼Ÿ\\n\\nä¸Šè¿°é—®é¢˜éƒ½æ˜¯ä¸‹ä¸€æ­¥éœ€è¦è§£å†³çš„é—®é¢˜ï¼Œå…¶å®é—®é¢˜çš„è§£å†³æ–¹æ³•ä¹Ÿä¸å°‘ã€‚ç›®å‰ç¬”è€…é‡‡ç”¨äº†å…ˆç»Ÿè®¡ä¸‹ä¸¤ç‚¹ä¹‹é—´çš„çº¿æ¡æ•°ï¼Œå†å°†è¿™äº›è¿æ¥çº¿åˆ†é…åˆ°ä¸€ä¸ª map é‡Œï¼Œä¸¤ä¸ªèŠ‚ç‚¹çš„ name å­—æ®µè¿›è¡Œæ‹¼æ¥åšæˆ keyï¼Œè¿™æ ·è®¡ç®—å¾—åˆ°ä¸¤ç‚¹ä¹‹é—´çš„è¿æ¥çº¿æ€»æ•°ã€‚\\n\\nç„¶ååœ¨éå†æ—¶åŒ map çš„çº¿æ ¹æ®æ–¹å‘åˆ†æˆæ­£å‘ã€åå‘ä¸¤ç»„ï¼Œæ­£å‘ç»„éå†ç»™æ¯æ¡çº¿è¿½åŠ è®¾ç½®ä¸€ä¸ª linknum ç¼–å·ï¼ŒåŒç†ï¼Œåå‘ç»„éå†è¿½åŠ ä¸€ä¸ª -linknum ç¼–å·å€¼ã€‚è¿™ä¸ªæ­£å‘ã€åå‘åˆ¤æ–­æ–¹æ³•å¾ˆå¤šï¼Œç¬”è€…æ˜¯æ ¹æ®èŠ‚ç‚¹ source.nameã€target.name è¿›è¡Œæ¯”è¾ƒï¼Œbtwï¼Œè¿™é‡Œå…¶å®æ˜¯æ¯”è¾ƒ ASCII ç ã€‚å®šä¹‰è¿æ¥çº¿çš„æ­£åæ–¹å‘åŠæ³•å¤ªå¤šäº†ï¼Œç”¨ä¸¤ç‚¹ä¹‹é—´çš„ä»»æ„å›ºå®šå­—æ®µæ¯”è¾ƒå³å¯ï¼Œåœ¨è¿™é‡Œä¸åšèµ˜è¿°ã€‚è€Œæˆ‘ä»¬è®¾å®šçš„ linknum å€¼å°±æ˜¯æ¥ç¡®å®šè¯¥æ¡å¼§çº¿çš„å¼¯æ›²åº¦å’Œå¼¯æ›²æ–¹å‘çš„ï¼Œè¿™é‡Œæ­é…ä¸‹é¢ä»£ç è®²è§£æ¯”è¾ƒå¥½ç†è§£ï¼š\\n\\n```\\n  const linkGroup = {};\\n  // ä¸¤ç‚¹ä¹‹é—´çš„çº¿æ ¹æ®ä¸¤ç‚¹çš„ name å±æ€§è®¾ç½®ä¸ºåŒä¸€ä¸ª keyï¼ŒåŠ å…¥åˆ° linkGroup ä¸­ï¼Œç»™ä¸¤ç‚¹ä¹‹é—´çš„æ‰€æœ‰è¾¹åˆ†æˆä¸€ä¸ªç»„\\n  edges.forEach((link: any) => {\\n    const key =\\n      link.source.name < link.target.name\\n        ? link.source.name + ':' + link.target.name\\n        : link.target.name + ':' + link.source.name;\\n    if (!linkGroup.hasOwnProperty(key)) {\\n      linkGroup[key] = [];\\n    }\\n    linkGroup[key].push(link);\\n  });\\n  // éå†ç»™æ¯ç»„å»è°ƒç”¨ setLinkNumbers æ¥åˆ†é… linkum\\n  edges.forEach((link: any) => {\\n    const key = setLinkName(link);\\n    link.size = linkGroup[key].length;\\n    const group = linkGroup[key];\\n    const keyPair = key.split(':');\\n    let type = 'noself';\\n    if (keyPair[0] === keyPair[1]) {\\n      type = 'self';\\n    }\\n    setLinkNumbers(group, type);\\n  });\\n```\\n\\n```\\n#æ ¹æ®ä¸åŒæ–¹å‘åˆ†ä¸º linkAï¼ŒlinkB ä¸¤ä¸ªæ•°ç»„ï¼Œåˆ†åˆ«åˆ†é…ä¸¤ç§ linknumï¼Œä»è€Œæ§åˆ¶ä¸Šä¸‹æ¤­åœ†å¼§\\nexport function setLinkNumbers(group) {\\n  const len = group.length;\\n  const linksA: any = [];\\n  const linksB: any = [];\\n  for (let i = 0; i < len; i++) {\\n    const link = group[i];\\n    if (link.source.name < link.target.name) {\\n      linksA.push(link);\\n    } else {\\n      linksB.push(link);\\n    }\\n  }\\n  let startLinkANumber = 1;\\n  linksA.forEach(linkA=> {\\n    linkA.linknum = startLinkANumber++;\\n  }\\n  let startLinkBNumber = -1;\\n  linksB.forEach(linkB=> {\\n    linkB.linknum = startLinkBNumber--;\\n  }\\n}\\n```\\n\\næŒ‰ç…§æˆ‘ä»¬ä¸Šé¢æè¿°çš„æ€è·¯ï¼Œç»™æ¯æ¡è¿æ¥çº¿åˆ†é… linknum å€¼åï¼Œæ¥ç€åœ¨å®ç°ç›‘å¬è¿æ¥çº¿çš„çš„ tick äº‹ä»¶å‡½æ•°é‡Œé¢åˆ¤æ–­ linknum æ­£è´Ÿæ•°åˆ¤æ–­è®¾ç½® [path è·¯å¾„çš„å¼¯æ›²åº¦å’Œæ–¹å‘](https://www.w3school.com.cn/svg/svg_path.asp) å°±è¡Œäº†ï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾\\n\\n![nebula-studio](https://www-cdn.nebula-graph.com.cn/nebula-blog/d305.png)\\n\\n## ç»“è¯­\\n\\nå¥½äº†ï¼Œä»¥ä¸Šä¾¿æ˜¯ç¬”è€…ä½¿ç”¨ D3.js åŠ›å¯¼å‘å›¾å®ç°å…³ç³»ç½‘çš„ä¼˜åŒ–æ€è·¯å’Œæ–¹æ³•ã€‚å…¶å®è¦æ„å»ºä¸€ä¸ªå¤æ‚çš„å…³ç³»ç½‘ï¼Œéœ€è¦è€ƒè™‘çš„é—®é¢˜å¾ˆå¤šï¼Œéœ€è¦ä¼˜åŒ–çš„åœ°æ–¹ä¹Ÿå¾ˆå¤šï¼Œä»Šå¤©ç»™å¤§å®¶åˆ†äº«ä¸¤ä¸ªæœ€å®¹æ˜“é‡åˆ°çš„æ–°èŠ‚ç‚¹å‘ˆç°ã€å¤šè¾¹å¤„ç†é—®é¢˜ï¼Œåç»­æˆ‘ä»¬ä¼šç»§ç»­äº§å‡º D3.js ä¼˜åŒ–ç³»åˆ—æ–‡ï¼Œæ¬¢è¿è®¢é˜… Nebula Graph åšå®¢ã€‚\\n\\næœ€åï¼Œä½ å¯ä»¥é€šè¿‡è®¿é—®å›¾æ•°æ®åº“ Nebula Graph Studioï¼š[Nebula-Graph-Studio](https://docs.nebula-graph.com.cn/2.0.1/nebula-studio/deploy-connect/st-ug-deploy/)ï¼Œä½“éªŒä¸‹ D3.js æ˜¯å¦‚ä½•å‘ˆç°å…³ç³»çš„ã€‚æœ¬æ–‡ä¸­å¦‚æœ‰ä»»ä½•é”™è¯¯æˆ–ç–æ¼æ¬¢è¿å» GitHubï¼š[https://github.com/vesoft-inc/nebula](https://github.com/vesoft-inc/nebula) issue åŒºå‘æˆ‘ä»¬æ issue æˆ–è€…å‰å¾€å®˜æ–¹è®ºå›ï¼š[https://discuss.nebula-graph.com.cn/](https://discuss.nebula-graph.com.cn/) çš„ `å»ºè®®åé¦ˆ` åˆ†ç±»ä¸‹æå»ºè®® ğŸ‘ï¼›äº¤æµå›¾æ•°æ®åº“æŠ€æœ¯ï¼ŸåŠ å…¥ Nebula äº¤æµç¾¤è¯·å…ˆ[å¡«å†™ä¸‹ä½ çš„ Nebula åç‰‡](https://wj.qq.com/s2/8321168/8e2f/)ï¼ŒNebula å°åŠ©æ‰‹ä¼šæ‹‰ä½ è¿›ç¾¤~~\\n\\n\\n> ä½œè€…æœ‰è¯è¯´ï¼šHiï¼Œæˆ‘æ˜¯ Nicoï¼Œæ˜¯ Nebula Graph çš„å‰ç«¯å·¥ç¨‹å¸ˆï¼Œå¯¹æ•°æ®å¯è§†åŒ–æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œåˆ†äº«ä¸€äº›è‡ªå·±çš„å®è·µå¿ƒå¾—ï¼Œå¸Œæœ›è¿™æ¬¡åˆ†äº«èƒ½ç»™å¤§å®¶å¸¦æ¥å¸®åŠ©ï¼Œå¦‚æœ‰ä¸å½“ä¹‹å¤„ï¼Œæ¬¢è¿å¸®å¿™çº æ­£ï¼Œè°¢è°¢~\\n\\n\",\n  \"pic\": \"https://www-cdn.nebula-graph.com.cn/nebula-blog/d302.png\",\n  \"slug\": \"d3-force-layout-optimization\",\n  \"publish\": 1\n}",
  "headers" : [ ],
  "paths" : [ ],
  "responseBody" : "{\n    \"code\": 0,\n    \"message\": \"success\",\n    \"data\": 203,\n    \"timestamp\": 1660119698888,\n    \"executeTime\": 40\n}",
  "description" : null,
  "requestBodyDefinition" : {
    "name" : "",
    "value" : "",
    "description" : "",
    "required" : false,
    "dataType" : "Object",
    "type" : null,
    "defaultValue" : null,
    "validateType" : "",
    "error" : "",
    "expression" : "",
    "children" : [ {
      "name" : "title",
      "value" : "D3.js åŠ›å¯¼å‘å›¾çš„æ˜¾ç¤ºä¼˜åŒ–",
      "description" : "",
      "required" : false,
      "dataType" : "String",
      "type" : null,
      "defaultValue" : null,
      "validateType" : "",
      "error" : "",
      "expression" : "",
      "children" : [ ]
    }, {
      "name" : "date",
      "value" : "2020-04-29 00:00:00",
      "description" : "",
      "required" : false,
      "dataType" : "String",
      "type" : null,
      "defaultValue" : null,
      "validateType" : "",
      "error" : "",
      "expression" : "",
      "children" : [ ]
    }, {
      "name" : "description",
      "value" : "æˆ‘ä»¬ç”¨ D3.js åŠ›å¯¼å‘å›¾å¯¹æ•°æ®å…³ç³»è¿›è¡Œåˆ†æï¼Œå…¶èŠ‚ç‚¹å’Œå…³ç³»çº¿ç›´è§‚åœ°ä½“ç°å›¾æ•°æ®åº“çš„æ•°æ®å…³ç³»ï¼Œè¿˜æ”¯æŒå…³è”ç›¸å¯¹åº”çš„å›¾æ•°æ®åº“è¯­å¥å®Œæˆæ‹“å±•æŸ¥è¯¢ã€‚æœ¬æ–‡ç€é‡è®²è§£å¦‚ä½•ä¼˜åŒ–æ–°å¢èŠ‚ç‚¹å’Œå¤šè¾¹å…³ç³»çš„æ˜¾ç¤º",
      "description" : "",
      "required" : false,
      "dataType" : "String",
      "type" : null,
      "defaultValue" : null,
      "validateType" : "",
      "error" : "",
      "expression" : "",
      "children" : [ ]
    }, {
      "name" : "tags",
      "value" : "",
      "description" : "",
      "required" : false,
      "dataType" : "Array",
      "type" : null,
      "defaultValue" : null,
      "validateType" : "",
      "error" : "",
      "expression" : "",
      "children" : [ {
        "name" : "",
        "value" : "å‘¨è¾¹å·¥å…·",
        "description" : "",
        "required" : false,
        "dataType" : "String",
        "type" : null,
        "defaultValue" : null,
        "validateType" : "",
        "error" : "",
        "expression" : "",
        "children" : [ ]
      } ]
    }, {
      "name" : "author",
      "value" : "Nico",
      "description" : "",
      "required" : false,
      "dataType" : "String",
      "type" : null,
      "defaultValue" : null,
      "validateType" : "",
      "error" : "",
      "expression" : "",
      "children" : [ ]
    }, {
      "name" : "content",
      "value" : "\\n![d3](https://www-cdn.nebula-graph.com.cn/nebula-blog/d303.jpeg)\\n\\n## D3.js \\n\\nä½œä¸ºä¸€ä¸ªå‰ç«¯ï¼Œè¯´åˆ°å¯è§†åŒ–é™¤äº†å¬è¿‡ [D3.js](https://d3js.org/) çš„å¤§åï¼Œå¸¸è§çš„å¯è§†åŒ–åº“è¿˜æœ‰ [ECharts](https://echarts.apache.org/examples/zh/index.html)ã€[Chart.js](http://chartjs.cn/)ï¼Œè¿™ä¸¤ä¸ªåº“åŠŸèƒ½ä¹Ÿå¾ˆå¼ºå¤§ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå…±åŒç‰¹ç‚¹æ˜¯**å°è£…å±‚æ¬¡é«˜**ï¼Œç•™ç»™å¼€å‘è€…å¯è®¾è®¡å’Œæ§åˆ¶çš„éƒ¨åˆ†å¤ªå°‘ã€‚å’Œ EChartã€Chart.js ç­‰ç›¸æ¯”ï¼ŒD3.js **ç›¸å¯¹æ¥è¯´è‡ªç”±åº¦ä¼šé«˜å¾ˆå¤š**ï¼Œå¾—ç›Šäº D3.js ä¸­ **SVG ç”»å›¾å¯¹äº‹ä»¶å¤„ç†å™¨çš„æ”¯æŒ**ï¼ŒD3.js å¯å°†ä»»æ„æ•°æ®ç»‘å®šåˆ°æ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼ˆDOMï¼‰ä¸Šï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ“ä½œå¯¹è±¡æ¨¡å‹ï¼ˆDOMï¼‰å®Œæˆ [W3C DOM API](https://www.w3.org/DOM/DOMTR) ç›¸å…³æ“ä½œï¼Œå¯¹äºæƒ³è¦å±•ç¤ºè‡ªå·±è®¾è®¡å›¾å½¢çš„å¼€å‘è€…ï¼ŒD3.js ç»å¯¹æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚\\n\\n## d3-force åŠ›å¯¼å‘å›¾\\n\\næ‹¿å®ç°ä¸€ä¸ªå…³ç³»ç½‘ä¸ºä¾‹ï¼Œd3-force åŠ›å¯¼å‘å›¾æ˜¯ä¸äºŒçš„é€‰æ‹©ã€‚\\n\\n[d3-force](https://d3js.org.cn/document/d3-force/#installing) æ˜¯ D3.js å®ç°ä»¥æ¨¡æ‹Ÿç²’å­ç‰©ç†è¿åŠ¨çš„ [velocity Verlet](https://en.wikipedia.org/wiki/Verlet_integration) æ•°å€¼ç§¯åˆ†å™¨çš„æ¨¡å—ï¼Œå¯ç”¨æ¥æ§åˆ¶ç²’å­å’Œè¾¹ç§©åºã€‚åœ¨[åŠ›å¯¼å‘å›¾](https://d3js.org.cn/document/d3-force/#installing)ä¸­ï¼Œd3-force ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªæ”¾ç”µç²’å­ï¼Œç²’å­é—´å­˜åœ¨æŸç§æ–¥åŠ›ï¼ˆåº“ä»‘æ–¥åŠ›ï¼‰ã€‚åŒæ—¶ï¼Œè¿™äº›ç²’å­é—´è¢«å®ƒä»¬ä¹‹é—´çš„â€œè¾¹â€æ‰€ç‰µè¿ï¼Œä»è€Œäº§ç”Ÿç‰µå¼•åŠ›ã€‚\\n\\nåœ¨ d3-force ä¸­ï¼Œç²’å­åœ¨æ–¥åŠ›å’Œç‰µå¼•åŠ›çš„ä½œç”¨ä¸‹ï¼Œä»éšæœºæ— åºçš„åˆæ€ä¸æ–­å‘ç”Ÿä½ç§»ï¼Œé€æ¸è¶‹äºå¹³è¡¡æœ‰åºã€‚æ•´ä¸ªå›¾åªæœ‰ç‚¹ / è¾¹ï¼Œå›¾å½¢å®ç°[å®˜æ–¹æ ·ä¾‹](https://observablehq.com/collection/@d3/d3-force)è¾ƒå°‘ä¸”è‡ªå®šä¹‰æ ·å¼å±…å¤šã€‚\\n\\nä¸‹å›¾å°±æ˜¯æœ€ç®€å•çš„å…³ç³»ç½‘å›¾ï¼Œæƒ³è¦å®ç°è‡ªå·±æƒ³è¦çš„å…³ç³»ç½‘å›¾ï¼Œé‡‡ç”¨ D3.js æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚\\n\\n![d3-force](https://www-cdn.nebula-graph.com.cn/nebula-blog/d302.png)\\n\\n## æ„å»º D3.js åŠ›å¯¼å‘å›¾\\n\\nåœ¨è¿™é‡Œçš„å®è·µè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç”¨ D3.js åŠ›å¯¼å‘å›¾æ¥å¯¹å›¾æ•°æ®åº“çš„æ•°æ®å…³ç³»è¿›è¡Œåˆ†æï¼šå…¶èŠ‚ç‚¹å’Œå…³ç³»çº¿ç›´è§‚åœ°ä½“ç°å‡ºå›¾æ•°æ®åº“çš„æ•°æ®å…³ç³»ï¼Œä¸”æ”¯æŒå…³è”å¯¹åº”æŸ¥è¯¢è¯­å¥å®Œæˆæ‹“å±•æŸ¥è¯¢ã€‚è¿›é˜¶æ¥è¯´ï¼Œå¯é€šè¿‡å¯¹æ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼ˆDOMï¼‰çš„ç›´æ¥æ“ä½œåŒæ­¥æ•°æ®åº“è¿›è€Œæ›´æ–°æ•°æ®ï¼Œå½“ç„¶æ“ä½œè¿™ä¸ªæ¯”è¾ƒå¤æ‚ï¼ŒğŸ˜‚ ä¸åœ¨æœ¬æ–‡ä¸­è¯¦ç»†è®²è¿°ã€‚\\n\\nä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªç®€å•çš„åŠ›å¯¼å‘å›¾ï¼Œåˆçª¥ D3.js å¯¹æ•°æ®åˆ†æçš„ä½œç”¨å’Œæ˜¾ç¤ºä¼˜åŒ–çš„ä¸€äº›æ€è·¯ã€‚é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŠ›å¯¼å‘å›¾ï¼š\\n\\n```\\nthis.force = d3\\n        .forceSimulation()\\n        // ä¸ºèŠ‚ç‚¹åˆ†é…åæ ‡\\n        .nodes(data.vertexes)\\n        // è¿æ¥çº¿\\n        .force('link', linkForce)\\n        // æ•´ä¸ªå®ä¾‹ä¸­å¿ƒ\\n        .force('center', d3.forceCenter(width / 2, height / 2))\\n        // å¼•åŠ›\\n        .force('charge', d3.forceManyBody().strength(-20))\\n        // ç¢°æ’åŠ› é˜²æ­¢èŠ‚ç‚¹é‡å \\n        .force('collide',d3.forceCollide().radius(60).iterations(2));\\n```\\n\\né€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹é¢è¿™æ ·ä¸€ä¸ªå¯è§†åŒ–çš„èŠ‚ç‚¹å’Œå…³ç³»å›¾ã€‚\\n\\n![vertex-relation](https://www-cdn.nebula-graph.com.cn/nebula-blog/d303.png)\\n\\n### å®ç°æ‹“å±•æŸ¥è¯¢æ˜¾ç¤ºä¼˜åŒ–\\n\\nçœ‹åˆ°å…³ç³»å›¾ï¼ˆä¸Šå›¾ï¼‰ï¼Œæˆ‘ä»¬ä¼šå‘ç°æœ‰ä¸€ä¸ªæ–°éœ€æ±‚ï¼š**é€‰ä¸­èŠ‚ç‚¹ç»§ç»­å¾€ä¸‹æ‹“å±•æŸ¥è¯¢**ã€‚ä¸ºäº†å®ç°æ‹“å±•æŸ¥è¯¢ï¼Œåœ¨è¿™é‡Œç¬”è€…è¦ä»‹ç»ä¸‹ D3.js è‡ªå¸¦ APIã€‚\\n\\nD3.js çš„ [enter()](https://www.d3js.org.cn/#enter%E5%92%8Cexit%E6%93%8D%E4%BD%9C) API å¯å¯¹æ–°å¢çš„èŠ‚ç‚¹ä½œå•ç‹¬çš„é€»è¾‘å¤„ç†ï¼Œæ‰€ä»¥å½“æ‹“å±•æŸ¥è¯¢åˆ°æ–°çš„èŠ‚ç‚¹ push è¿›èŠ‚ç‚¹æ•°ç»„æ—¶ï¼Œä¸ä¼šå»æ”¹å˜ä¹‹å‰å­˜åœ¨çš„èŠ‚ç‚¹ä¿¡æ¯ï¼ˆåŒ…æ‹¬ xï¼Œy åæ ‡)ï¼Œè€Œæ˜¯æŒ‰ç…§ d3-force å®ä¾‹åˆ†é…çš„åæ ‡è¿›è¡Œæ¸²æŸ“ã€‚ä» API è§’åº¦æ¥ç†è§£ï¼Œè¿™æ ·å¤„ç†æ²¡é—®é¢˜ï¼Œä½†å¯¹ d3-force ä¸­å·²å­˜åœ¨çš„å®ä¾‹æ¥è¯´ï¼Œæ–°å¢çš„èŠ‚ç‚¹ä¸æ˜¯ä¸€ä¸ªç®€å•çš„ push å°±èƒ½å¤„ç†çš„ã€‚å› ä¸º [d3.forceSimulation()](https://github.com/d3/d3-force/blob/master/src/simulation.js)  è¿™ä¸ªæ¨¡å‹ç»™å½“å‰èŠ‚ç‚¹åˆ†é…çš„ä½ç½®åæ ‡ï¼ˆxï¼Œyï¼‰æ˜¯éšæœºï¼Œç›®å‰çœ‹æ¥è¿™æ ·æ“ä½œæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå¯¹ä¸å¯¹ï¼Ÿ\\n\\nä½†ç”±äº `d3.forceSimulation().node()` åæ ‡éšæœºåˆ†é…å¯¼è‡´äº†å›¾å½¢æ‹“å±•å‡ºæ¥ä½ç½®çš„éšæœºå‡ºç°ï¼Œåœ¨ä¹‹å‰ d3-force å®ä¾‹ä¸­æˆ‘ä»¬è®¾å®šå¥½çš„ collideï¼ˆç¢°æ’åŠ›ï¼‰å’Œ links ï¼ˆå¼•åŠ›ï¼‰å‚æ•°ä½œç”¨ä¸‹ï¼Œå’Œæ–°èŠ‚ç‚¹ç›¸å…³è”çš„èŠ‚ç‚¹å—åˆ°ç‰µå¼•åŠ›å½±å“äº’ç›¸é è¿‘ï¼Œåœ¨é è¿‘çš„è¿‡ç¨‹ä¸­åˆä¼šå’Œå…¶ä»–èŠ‚ç‚¹å‘ç”Ÿç¢°æ’ã€‚å½“åŠ›å¯¼å›¾å·²å­˜åœ¨èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œè¿™äº›æ–°å¢èŠ‚ç‚¹å‡ºç°æ—¶ä¼šè®©æ•´ä¸ªåŠ›å¯¼å‘å›¾åœ¨ collide å’Œ links çš„ä½œç”¨ä¸‹ä¸åœåœ°ç¢°æ’ï¼Œè¿›è¡Œç‰µå¼•ï¼Œç›´åˆ°æ¯ä¸ªèŠ‚ç‚¹éƒ½æ‰¾åˆ°è‡ªå·±åˆé€‚çš„ä½ç½®ï¼Œå³ç¢°æ’åŠ›å’Œç‰µå¼•åŠ›éƒ½æ»¡è¶³è¦æ±‚æ—¶æ‰åœæ­¢ç§»åŠ¨ï¼Œçœ‹çœ‹ä¸‹å›¾ï¼Œåƒä¸åƒå®‡å®™å¤§çˆ†ç‚¸ ğŸŒã€‚\\n\\n![d3](https://www-cdn.nebula-graph.com.cn/nebula-blog/d304.gif)\\n\\nä¸Šè¿°æ— åºåˆ°æœ‰åºç†µå‡çš„è¿‡ç¨‹ï¼Œç«™åœ¨ç”¨æˆ·è§’åº¦ï¼Œæ¯æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹å¯¼è‡´æ•´ä¸ªåŠ›å¯¼å›¾çš„è¿åŠ¨ï¼Œé™¤äº†æœ‰ä¸€ç§æŠ½ææ„Ÿï¼Œåœæ­¢å›¾å½¢å˜åŒ–åˆéœ€è¦é•¿æ—¶é—´çš„ç­‰å¾…ï¼Œè¿™æ˜¯ä¸èƒ½æ¥å—çš„ã€‚å¯ D3.js API [enter()](https://www.d3js.org.cn/#enter%E5%92%8Cexit%E6%93%8D%E4%BD%9C) åˆæ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œéš¾é“æ–°å¢çš„èŠ‚ç‚¹å’Œä¹‹å‰çš„èŠ‚ç‚¹çš„å‘ˆç°å¤„ç†éœ€è¦å¼€å‘è€…åˆ†å¼€å•ç‹¬å¤„ç†å—ï¼Ÿå¦‚æœæ˜¯åˆ†å¼€å•ç‹¬å¤„ç†ï¼Œæ¯æ¬¡èŠ‚ç‚¹æ¸²æŸ“éƒ½è¦éå†åˆ¤æ–­æ˜¯ä¸æ˜¯æ–°å¢ï¼Œåœ¨èŠ‚ç‚¹è¾ƒå¤šæ—¶åè€Œæ›´å½±å“æ€§èƒ½ï¼Ÿé‚£ä¹ˆå¦‚ä½•ä¼˜åŒ–è¿™ä¸ªæ–°å¢èŠ‚ç‚¹å‘ˆç°çš„é—®é¢˜å‘¢ï¼Ÿ\\n\\nç½‘ä¸Šè§£å†³æ–°å¢èŠ‚ç‚¹å‘ˆç°é—®é¢˜ï¼Œå¤§å¤šé‡‡ç”¨å‡å° d3-force å®ä¾‹ collideï¼Œå¢å¤§ links çš„ distance å‚æ•°å€¼ï¼Œè¿™æ ·ä¼šè®©èŠ‚ç‚¹å¾ˆå¿«åœ°æ‰¾åˆ°å¹³è¡¡ç‚¹ä»è€Œä½¿æ•´ä¸ªåŠ›å¯¼å›¾ç¨³å®šä¸‹æ¥ï¼Œè¿™ç¡®å®æ˜¯ä¸€ä¸ªå¥½åŠæ³•ã€‚ä½†æ˜¯è¿™æ ·èŠ‚ç‚¹ä¹‹é—´çš„è¿çº¿é•¿åº¦ç›¸å·®æ˜æ˜¾ï¼Œè€Œä¸”å›¾å½¢æ•´ä½“åå¤§ï¼Œå¯¹äºå¤§æ•°æ®é‡çš„ case æ¥è¯´ï¼Œè¿™ç§æ˜¾ç¤ºæ–¹å¼å¹¶ä¸å¤ªé€‚åˆã€‚\\n\\nåŸºäºä¸Šè¿°çš„æ–¹æ³•ï¼Œç¬”è€…æœ‰äº†å¦ä¸€ç§è§£å†³æ€è·¯â€”â€”**ä¿è¯æ–°å¢èŠ‚ç‚¹æ˜¯åœ¨è¯¥é€‰ä¸­æ‹“å±•çš„èŠ‚ç‚¹å‘¨å›´**ï¼Œä¹Ÿå°±æ˜¯è¯´ç›´æ¥æŠŠæ–°å¢èŠ‚ç‚¹çš„åæ ‡è®¾ç½®ä¸ºå¯¹åº”é€‰æ‹©æ‹“å±•èŠ‚ç‚¹ä¸€æ ·çš„ x,y åæ ‡è€Œä¸ç”¨ D3 .forceSimulation().node() åˆ†é…ï¼Œè¿™æ ·åˆ©ç”¨ d3-force è¿™ä¸ªå®ä¾‹çš„èŠ‚ç‚¹ç¢°æ’åŠ›ï¼Œä¿è¯æ–°å¢èŠ‚ç‚¹çš„å‡ºç°éƒ½ä¸ä¼šè¦†ç›–ï¼Œæœ€ç»ˆä¼šåœ¨é€‰ä¸­æ‹“å±•èŠ‚ç‚¹å‘¨å›´å‡ºç°ã€‚ è¿™æ ·å¤„ç†è™½ç„¶è¿˜æ˜¯å¯¹æ–°å¢èŠ‚ç‚¹å°çš„èŒƒå›´å†…çš„èŠ‚ç‚¹æœ‰å½±å“ï¼Œä½†ç›¸å¯¹æ¥è¯´ï¼Œä¸ä¼šå¤§å¹…åº¦åœ°å½±å“æ•´ä¸ªå…³ç³»å›¾å½¢èµ°åŠ¿ã€‚å…³é”®ä»£ç å¦‚ä¸‹ï¼š\\n\\n```\\n# ç»™æ–°å¢çš„åæ ‡è®¾ç½®ä¸ºæ‹“å±•èµ·ç‚¹ä¸­å¿ƒæˆ–æ•´ä¸ªå›¾ä¸­å¿ƒ\\naddVertexes.map(d => {\\n  d.x = _.meanBy(selectVertexes, 'x') || svg.style('width') / 2;\\n  d.y = _.meanBy(selectVertexes, 'y') || svg.style('heigth') / 2;\\n});\\n```\\n\\nå¦‚æœæ²¡æœ‰é€‰ä¸­èŠ‚ç‚¹ï¼ˆå³æ·»åŠ èµ·ç‚¹ï¼‰åˆ™è¯¥èµ·ç‚¹åæ ‡ä½ç½®å°±åœ¨å›¾ä¸­å¿ƒä½ç½®ï¼Œå¯¹å·²å­˜åœ¨çš„èŠ‚ç‚¹æ¥è¯´ï¼Œå½±å“ç¨‹åº¦ä¼šå°å¾ˆå¤šï¼Œè¿™è¿˜æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„æ€è·¯ï¼Œè¿™ä¸ªè§£å†³åŠæ³•å¯ä»¥æ¨èä¸€ä¸‹ã€‚\\n\\né™¤äº†æ–°å¢èŠ‚ç‚¹çš„å‘ˆç°é—®é¢˜ï¼Œæ•´ä¸ªå›¾å½¢çš„å‘ˆç°è¿˜æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼š**ä¸¤ç‚¹ä¹‹é—´å¤šè¾¹æ˜¾ç¤ºçš„ä¼˜åŒ–å¤„ç†**ã€‚\\n\\n### ä¸¤ç‚¹ä¹‹é—´å¤šè¾¹æ˜¾ç¤ºçš„ä¼˜åŒ–å¤„ç†\\n\\n> å½“ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´å­˜åœ¨å¤šæ¡è¾¹å…³ç³»æ—¶ï¼Œé»˜è®¤è¿æ¥çº¿æ˜¯ç›´çº¿çš„æƒ…å†µä¸‹è‚¯å®šä¼šå‡ºç°å¤šçº¿è¦†ç›–ã€‚å› æ­¤æ›²çº¿è¿æ¥ä¾¿æˆäº†æˆ‘ä»¬çš„å¦å¤–éœ€è¦è§£å†³çš„é—®é¢˜ã€‚\\n> æ›²çº¿å¦‚ä½•å®šä¹‰å¼¯æ›²åº¦ä¿è¯ä¸¤ç‚¹ä¹‹é—´çš„å¤šæ¡çº¿ä¸ä¼šäº¤äº’è¦†ç›–å‘¢ï¼Ÿåœ¨å¤šæ¡çº¿å¼¯æ›²ä¸‹ï¼Œå¦‚ä½•å¹³å‡åŠåœ†å¼§å¼¯æ›²é¿å…å…¨è·‘åˆ°æŸåŠåœ†å¼§ä¸Šï¼Ÿå®šä¹‰æ›²çº¿å¼§æ–¹å‘ï¼Ÿ\\n\\nä¸Šè¿°é—®é¢˜éƒ½æ˜¯ä¸‹ä¸€æ­¥éœ€è¦è§£å†³çš„é—®é¢˜ï¼Œå…¶å®é—®é¢˜çš„è§£å†³æ–¹æ³•ä¹Ÿä¸å°‘ã€‚ç›®å‰ç¬”è€…é‡‡ç”¨äº†å…ˆç»Ÿè®¡ä¸‹ä¸¤ç‚¹ä¹‹é—´çš„çº¿æ¡æ•°ï¼Œå†å°†è¿™äº›è¿æ¥çº¿åˆ†é…åˆ°ä¸€ä¸ª map é‡Œï¼Œä¸¤ä¸ªèŠ‚ç‚¹çš„ name å­—æ®µè¿›è¡Œæ‹¼æ¥åšæˆ keyï¼Œè¿™æ ·è®¡ç®—å¾—åˆ°ä¸¤ç‚¹ä¹‹é—´çš„è¿æ¥çº¿æ€»æ•°ã€‚\\n\\nç„¶ååœ¨éå†æ—¶åŒ map çš„çº¿æ ¹æ®æ–¹å‘åˆ†æˆæ­£å‘ã€åå‘ä¸¤ç»„ï¼Œæ­£å‘ç»„éå†ç»™æ¯æ¡çº¿è¿½åŠ è®¾ç½®ä¸€ä¸ª linknum ç¼–å·ï¼ŒåŒç†ï¼Œåå‘ç»„éå†è¿½åŠ ä¸€ä¸ª -linknum ç¼–å·å€¼ã€‚è¿™ä¸ªæ­£å‘ã€åå‘åˆ¤æ–­æ–¹æ³•å¾ˆå¤šï¼Œç¬”è€…æ˜¯æ ¹æ®èŠ‚ç‚¹ source.nameã€target.name è¿›è¡Œæ¯”è¾ƒï¼Œbtwï¼Œè¿™é‡Œå…¶å®æ˜¯æ¯”è¾ƒ ASCII ç ã€‚å®šä¹‰è¿æ¥çº¿çš„æ­£åæ–¹å‘åŠæ³•å¤ªå¤šäº†ï¼Œç”¨ä¸¤ç‚¹ä¹‹é—´çš„ä»»æ„å›ºå®šå­—æ®µæ¯”è¾ƒå³å¯ï¼Œåœ¨è¿™é‡Œä¸åšèµ˜è¿°ã€‚è€Œæˆ‘ä»¬è®¾å®šçš„ linknum å€¼å°±æ˜¯æ¥ç¡®å®šè¯¥æ¡å¼§çº¿çš„å¼¯æ›²åº¦å’Œå¼¯æ›²æ–¹å‘çš„ï¼Œè¿™é‡Œæ­é…ä¸‹é¢ä»£ç è®²è§£æ¯”è¾ƒå¥½ç†è§£ï¼š\\n\\n```\\n  const linkGroup = {};\\n  // ä¸¤ç‚¹ä¹‹é—´çš„çº¿æ ¹æ®ä¸¤ç‚¹çš„ name å±æ€§è®¾ç½®ä¸ºåŒä¸€ä¸ª keyï¼ŒåŠ å…¥åˆ° linkGroup ä¸­ï¼Œç»™ä¸¤ç‚¹ä¹‹é—´çš„æ‰€æœ‰è¾¹åˆ†æˆä¸€ä¸ªç»„\\n  edges.forEach((link: any) => {\\n    const key =\\n      link.source.name < link.target.name\\n        ? link.source.name + ':' + link.target.name\\n        : link.target.name + ':' + link.source.name;\\n    if (!linkGroup.hasOwnProperty(key)) {\\n      linkGroup[key] = [];\\n    }\\n    linkGroup[key].push(link);\\n  });\\n  // éå†ç»™æ¯ç»„å»è°ƒç”¨ setLinkNumbers æ¥åˆ†é… linkum\\n  edges.forEach((link: any) => {\\n    const key = setLinkName(link);\\n    link.size = linkGroup[key].length;\\n    const group = linkGroup[key];\\n    const keyPair = key.split(':');\\n    let type = 'noself';\\n    if (keyPair[0] === keyPair[1]) {\\n      type = 'self';\\n    }\\n    setLinkNumbers(group, type);\\n  });\\n```\\n\\n```\\n#æ ¹æ®ä¸åŒæ–¹å‘åˆ†ä¸º linkAï¼ŒlinkB ä¸¤ä¸ªæ•°ç»„ï¼Œåˆ†åˆ«åˆ†é…ä¸¤ç§ linknumï¼Œä»è€Œæ§åˆ¶ä¸Šä¸‹æ¤­åœ†å¼§\\nexport function setLinkNumbers(group) {\\n  const len = group.length;\\n  const linksA: any = [];\\n  const linksB: any = [];\\n  for (let i = 0; i < len; i++) {\\n    const link = group[i];\\n    if (link.source.name < link.target.name) {\\n      linksA.push(link);\\n    } else {\\n      linksB.push(link);\\n    }\\n  }\\n  let startLinkANumber = 1;\\n  linksA.forEach(linkA=> {\\n    linkA.linknum = startLinkANumber++;\\n  }\\n  let startLinkBNumber = -1;\\n  linksB.forEach(linkB=> {\\n    linkB.linknum = startLinkBNumber--;\\n  }\\n}\\n```\\n\\næŒ‰ç…§æˆ‘ä»¬ä¸Šé¢æè¿°çš„æ€è·¯ï¼Œç»™æ¯æ¡è¿æ¥çº¿åˆ†é… linknum å€¼åï¼Œæ¥ç€åœ¨å®ç°ç›‘å¬è¿æ¥çº¿çš„çš„ tick äº‹ä»¶å‡½æ•°é‡Œé¢åˆ¤æ–­ linknum æ­£è´Ÿæ•°åˆ¤æ–­è®¾ç½® [path è·¯å¾„çš„å¼¯æ›²åº¦å’Œæ–¹å‘](https://www.w3school.com.cn/svg/svg_path.asp) å°±è¡Œäº†ï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾\\n\\n![nebula-studio](https://www-cdn.nebula-graph.com.cn/nebula-blog/d305.png)\\n\\n## ç»“è¯­\\n\\nå¥½äº†ï¼Œä»¥ä¸Šä¾¿æ˜¯ç¬”è€…ä½¿ç”¨ D3.js åŠ›å¯¼å‘å›¾å®ç°å…³ç³»ç½‘çš„ä¼˜åŒ–æ€è·¯å’Œæ–¹æ³•ã€‚å…¶å®è¦æ„å»ºä¸€ä¸ªå¤æ‚çš„å…³ç³»ç½‘ï¼Œéœ€è¦è€ƒè™‘çš„é—®é¢˜å¾ˆå¤šï¼Œéœ€è¦ä¼˜åŒ–çš„åœ°æ–¹ä¹Ÿå¾ˆå¤šï¼Œä»Šå¤©ç»™å¤§å®¶åˆ†äº«ä¸¤ä¸ªæœ€å®¹æ˜“é‡åˆ°çš„æ–°èŠ‚ç‚¹å‘ˆç°ã€å¤šè¾¹å¤„ç†é—®é¢˜ï¼Œåç»­æˆ‘ä»¬ä¼šç»§ç»­äº§å‡º D3.js ä¼˜åŒ–ç³»åˆ—æ–‡ï¼Œæ¬¢è¿è®¢é˜… Nebula Graph åšå®¢ã€‚\\n\\næœ€åï¼Œä½ å¯ä»¥é€šè¿‡è®¿é—®å›¾æ•°æ®åº“ Nebula Graph Studioï¼š[Nebula-Graph-Studio](https://docs.nebula-graph.com.cn/2.0.1/nebula-studio/deploy-connect/st-ug-deploy/)ï¼Œä½“éªŒä¸‹ D3.js æ˜¯å¦‚ä½•å‘ˆç°å…³ç³»çš„ã€‚æœ¬æ–‡ä¸­å¦‚æœ‰ä»»ä½•é”™è¯¯æˆ–ç–æ¼æ¬¢è¿å» GitHubï¼š[https://github.com/vesoft-inc/nebula](https://github.com/vesoft-inc/nebula) issue åŒºå‘æˆ‘ä»¬æ issue æˆ–è€…å‰å¾€å®˜æ–¹è®ºå›ï¼š[https://discuss.nebula-graph.com.cn/](https://discuss.nebula-graph.com.cn/) çš„ `å»ºè®®åé¦ˆ` åˆ†ç±»ä¸‹æå»ºè®® ğŸ‘ï¼›äº¤æµå›¾æ•°æ®åº“æŠ€æœ¯ï¼ŸåŠ å…¥ Nebula äº¤æµç¾¤è¯·å…ˆ[å¡«å†™ä¸‹ä½ çš„ Nebula åç‰‡](https://wj.qq.com/s2/8321168/8e2f/)ï¼ŒNebula å°åŠ©æ‰‹ä¼šæ‹‰ä½ è¿›ç¾¤~~\\n\\n\\n> ä½œè€…æœ‰è¯è¯´ï¼šHiï¼Œæˆ‘æ˜¯ Nicoï¼Œæ˜¯ Nebula Graph çš„å‰ç«¯å·¥ç¨‹å¸ˆï¼Œå¯¹æ•°æ®å¯è§†åŒ–æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œåˆ†äº«ä¸€äº›è‡ªå·±çš„å®è·µå¿ƒå¾—ï¼Œå¸Œæœ›è¿™æ¬¡åˆ†äº«èƒ½ç»™å¤§å®¶å¸¦æ¥å¸®åŠ©ï¼Œå¦‚æœ‰ä¸å½“ä¹‹å¤„ï¼Œæ¬¢è¿å¸®å¿™çº æ­£ï¼Œè°¢è°¢~\\n\\n",
      "description" : "",
      "required" : false,
      "dataType" : "String",
      "type" : null,
      "defaultValue" : null,
      "validateType" : "",
      "error" : "",
      "expression" : "",
      "children" : [ ]
    }, {
      "name" : "pic",
      "value" : "https://www-cdn.nebula-graph.com.cn/nebula-blog/d302.png",
      "description" : "",
      "required" : false,
      "dataType" : "String",
      "type" : null,
      "defaultValue" : null,
      "validateType" : "",
      "error" : "",
      "expression" : "",
      "children" : [ ]
    }, {
      "name" : "slug",
      "value" : "d3-force-layout-optimization",
      "description" : "",
      "required" : false,
      "dataType" : "String",
      "type" : null,
      "defaultValue" : null,
      "validateType" : "",
      "error" : "",
      "expression" : "",
      "children" : [ ]
    }, {
      "name" : "publish",
      "value" : "1",
      "description" : "",
      "required" : false,
      "dataType" : "Integer",
      "type" : null,
      "defaultValue" : null,
      "validateType" : "",
      "error" : "",
      "expression" : "",
      "children" : [ ]
    } ]
  },
  "responseBodyDefinition" : {
    "name" : "",
    "value" : "",
    "description" : "",
    "required" : false,
    "dataType" : "Object",
    "type" : null,
    "defaultValue" : null,
    "validateType" : "",
    "error" : "",
    "expression" : "",
    "children" : [ {
      "name" : "code",
      "value" : "0",
      "description" : "",
      "required" : false,
      "dataType" : "Integer",
      "type" : null,
      "defaultValue" : null,
      "validateType" : "",
      "error" : "",
      "expression" : "",
      "children" : [ ]
    }, {
      "name" : "message",
      "value" : "success",
      "description" : "",
      "required" : false,
      "dataType" : "String",
      "type" : null,
      "defaultValue" : null,
      "validateType" : "",
      "error" : "",
      "expression" : "",
      "children" : [ ]
    }, {
      "name" : "data",
      "value" : "203",
      "description" : "",
      "required" : false,
      "dataType" : "Object",
      "type" : null,
      "defaultValue" : null,
      "validateType" : "",
      "error" : "",
      "expression" : "",
      "children" : [ ]
    }, {
      "name" : "timestamp",
      "value" : "1660119698888",
      "description" : "",
      "required" : false,
      "dataType" : "Long",
      "type" : null,
      "defaultValue" : null,
      "validateType" : "",
      "error" : "",
      "expression" : "",
      "children" : [ ]
    }, {
      "name" : "executeTime",
      "value" : "40",
      "description" : "",
      "required" : false,
      "dataType" : "Integer",
      "type" : null,
      "defaultValue" : null,
      "validateType" : "",
      "error" : "",
      "expression" : "",
      "children" : [ ]
    } ]
  }
}
================================
var tx = db.transaction()

try {
    var blogId
    if (body.id) {
        blogId = db.update(
        """
        insert into website_blog (id, create_time,update_time,author,content,description,pic,publish,slug,title,create_user_id,update_user_id,blog_category_id) 
        values (
            #{body.id}
            #{body.date}, 
            #{body.date}, 
            #{body.author}, 
            #{body.content},
            #{body.description}, 
            #{body.pic}, 
            #{body.publish},
            #{body.slug},
            #{body.title},
            1,
            1,
            1)
        """
        )
    } else {
        blogId = db.insert(
        """
        insert into website_blog (create_time,update_time,author,content,description,pic,publish,slug,title,create_user_id,update_user_id,blog_category_id) 
        values (
            #{body.date}, 
            #{body.date}, 
            #{body.author}, 
            #{body.content},
            #{body.description}, 
            #{body.pic}, 
            #{body.publish},
            #{body.slug},
            #{body.title},
            1,
            1,
            1)
        """
        )
    }
    if (body.tags != null && body.tags.length > 0) {
        body.tags.map(tag => {
            var exitsTag = db.selectOne(
                """
                select * from website_blog_tag where name = #{tag}
                """)
            if (exitsTag) {
                db.insert(
                    """
                    insert into website_blog_tag_join (blog_id, tag_id) values (#{blogId}, #{exitsTag.id})
                    """
                )
            } else {
                var newTagId = db.insert(
                    """
                    insert into website_blog_tag (name) values (#{tag})
                    """
                )
                db.insert(
                    """
                    insert into website_blog_tag_join (blog_id, tag_id) values (#{blogId}, #{newTagId})
                    """
                )
            }
        })
    }
    tx.commit()
    return blogId
} catch(e) {
    tx.rollback()
    return 'å¯¼å…¥å¤±è´¥'
}


    